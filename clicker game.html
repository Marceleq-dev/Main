<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shrimp Clicker ü¶ê</title>
  <style>
    :root{
      --bg1:#283048; --bg2:#859398; --card:#32323C99;
      --btn:#4e5d6c; --btn-hover:#607184; --btn-disabled:#333a41;
      --accent:#7dd3fc;
    }
    html,body {height:100%; margin:0; position:relative; z-index:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:#eee;}
    .game-container{max-width:980px;margin:24px auto;padding:20px;text-align:center;}
    h1{margin:6px 0;text-shadow:0 2px 4px rgba(0,0,0,.7);}
    .shrimp{width:200px;height:200px;background:url('https://static.vecteezy.com/system/resources/previews/036/161/836/non_2x/tiger-shrimp-on-a-transparent-background-free-png.png') no-repeat center/contain;margin:18px auto;cursor:pointer;transition:transform .08s ease;}
    .shrimp:active{transform:scale(.94);}
    .stats{margin:10px 0;font-size:1.05rem;}
    .count {font-size:2rem;font-weight:700;display:inline-block;min-width:200px;transition:transform .2s;}
    .small{font-size:.9rem;color:#cfd8dc;}
    .upgrades{margin-top:20px;background:var(--card);display:inline-block;padding:18px 26px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.6);text-align:left;}
    .upgrade-btn{display:block;width:100%;text-align:left;padding:12px 16px;margin:8px 0;background-color:var(--btn);color:#f0f0f0;border:1px solid #62717a;border-radius:8px;cursor:pointer;transition:background .15s,transform .08s;}
    .upgrade-btn:hover:not(:disabled){background-color:var(--btn-hover);transform:translateX(4px);}
    .upgrade-btn:disabled{background-color:var(--btn-disabled);color:#777;cursor:not-allowed;}
    .upgrade-cost{float:right;font-weight:700;}
    .controls{margin-top:18px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
    .control-btn{background:#1f2937;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .control-btn:disabled{opacity:.5;cursor:not-allowed;}
    /* Floating shrimp image on click */
    .floating-shrimp{position:absolute;width:48px;height:48px;background-size:contain;animation:floatUp 1.2s ease-out forwards;pointer-events:none;z-index:120;}
    @keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-100px) scale(.9)}}
    /* click +1 text */
    .click-effect{position:absolute;font-size:1.6rem;font-weight:700;color:#fff;text-shadow:0 0 6px #000;pointer-events:none;animation:floatText 1s ease-out forwards;z-index:130;}
    @keyframes floatText{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-80px)}}
    /* purchase flash */
    .flash-buy{animation:flash .35s linear}
    @keyframes flash{0%{box-shadow:0 0 0 0 rgba(125,211,252,.55)}70%{box-shadow:0 0 0 16px rgba(125,211,252,0)}100%{box-shadow:none}}
    /* small UI helpers */
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .meta{font-size:.9rem;color:#cfd8dc}
    /* overlay modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000;opacity:0;pointer-events:none;transition:opacity .18s;}
    .modal.show{opacity:1;pointer-events:auto}
    .modal-card{background:#0f1724;padding:18px;border-radius:12px;color:#fff;min-width:280px;max-width:90%;box-shadow:0 8px 40px rgba(0,0,0,.6)}
    /* shop styles */
    .shop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px}
    .shop-item{background:#071025;border-radius:10px;padding:10px;text-align:center;border:1px solid rgba(255,255,255,0.04)}
    .shop-item img{width:100%;height:120px;object-fit:contain;border-radius:6px;background:#08202a;padding:6px}
    .shop-item button{margin-top:8px;width:100%}
    .owned-badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#0b7; color:#012; font-weight:700;margin-top:8px}
    /* responsive */
    @media (max-width:640px){
      .shrimp{width:150px;height:150px}
      .count{min-width:140px;font-size:1.4rem}
      .upgrades{width:92%}
    }
    /* leaderboard styles */
    .leaderboard{margin-top:12px;text-align:left;background:#111827;padding:12px;border-radius:8px;color:#e6eef3}
    .leaderboard h4{margin:0 0 8px 0}
    /* bounce animation for counters */
    .bump{animation:bump .18s ease}
    @keyframes bump{0%{transform:scale(1)}50%{transform:scale(1.09)}100%{transform:scale(1)}}

    .falling-shrimp {
      position: fixed;
      top: -80px;
      width: 60px;
      height: 60px;
      background-size: contain;
      background-repeat: no-repeat;
      pointer-events: none;
      opacity: 0.55;
      z-index: -1;
      animation: fallShrimp linear forwards;
    }

    @keyframes fallShrimp {
      from { transform: translateY(-120px) rotate(0deg); }
      to   { transform: translateY(110vh) rotate(360deg); }
    }

  </style>
</head>
<body>
  <div class="game-container">
    <h1>ü¶ê Shrimp Clicker ü¶ê</h1>
    <div style="font-size:.95rem;color:#bfcfe0;margin-top:6px">Player: <span id="playerNameDisplay">Guest</span></div>

    <div id="shrimp" class="shrimp" title="Click me!"></div>

    <div class="stats">
      <div class="row" style="justify-content:center;align-items:flex-end">
        <div style="text-align:center">
          <div class="small">Shrimps</div>
          <div id="counter" class="count">0</div>
        </div>
        <div style="text-align:left">
          <div class="small">Per Click</div>
          <div id="spc" class="count">1</div>
        </div>
        <div style="text-align:left">
          <div class="small">Per Second</div>
          <div id="sps" class="count">0</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="saveBtn" class="control-btn">Save</button>
      <button id="loadBtn" class="control-btn">Load</button>
      <!-- <button id="resetBtn" class="control-btn">Reset</button> -->
      <button id="submitLeaderBtn" class="control-btn">Submit Score</button>
      <button id="shopBtn" class="control-btn">Shop</button>
      <div style="align-self:center;color:#cbd5e1">Owned skins: <span id="ownedCount">0</span></div>
    </div>

    <div class="upgrades" id="upgradesBox" aria-live="polite">
      <h3>Upgrades</h3>

      <button id="upg-net" class="upgrade-btn">
        <span class="upgrade-title">Stronger Net (+1 SPC)</span>
        <span class="upgrade-cost" id="cost-net">20</span>
      </button>

      <button id="upg-sps1" class="upgrade-btn">
        <span class="upgrade-title">Small Fry Factory (+1 SPS)</span>
        <span class="upgrade-cost" id="cost-sps1">100</span>
      </button>

      <button id="upg-sps2" class="upgrade-btn">
        <span class="upgrade-title">Medium Shrimp Farm (+10 SPS)</span>
        <span class="upgrade-cost" id="cost-sps2">2000</span>
      </button>

      <button id="upg-sps3" class="upgrade-btn">
        <span class="upgrade-title">Mega Shrimp Reactor (+100 SPS)</span>
        <span class="upgrade-cost" id="cost-sps3">50000</span>
      </button>

      <div style="margin-top:12px" class="meta">
        Tip: Upgrades unlock visually when you reach 50% of their base cost.
      </div>
    </div>

    <div class="leaderboard" id="leaderboard">
      <h4>Top Players</h4>
      <ol id="leaders" style="margin:6px 0 0 16px;padding:0"></ol>
      <div style="margin-top:8px;font-size:.85rem;color:#bfcfe0">Best Shrimp Count: <span id="bestCount">0</span></div>
    </div>
  </div>

 
  <div id="nickModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Choose a nickname</h3>
      <p>Please enter a player nickname. This will be used for the leaderboard.</p>
      <input id="playerNameInput" type="text" placeholder="Type your nickname" style="width:100%;padding:8px;border-radius:6px;border:none;margin-top:8px" />
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="playerNameSave" class="control-btn">Save</button>
      </div>
    </div>
  </div>

 
  <div id="shopModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Shrimp Skins Shop</h3>
      <p>Spend shrimps to permanently unlock skins. Click "Equip" to apply a skin.</p>

      <div id="shopGrid" class="shop-grid"></div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="closeShop" class="control-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Admin Terminal Modal
  <div id="adminModal" class="modal">
    <div class="modal-card">
      <h3>Admin Terminal</h3>
      <p>Enter password to unlock:</p>
      <input type="password" id="adminPassword" style="width:100%;padding:6px;margin-top:6px;border-radius:6px;border:none"/>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="adminCancel" class="control-btn">Cancel</button>
        <button id="adminEnter" class="control-btn">Enter</button>
      </div>
      <div id="adminControls" style="display:none;margin-top:12px;">
        <label>Shrimps: <input type="number" id="adminShrimp" value="0"></label><br>
        <label>SPC: <input type="number" id="adminSPC" value="1"></label><br>
        <label>SPS: <input type="number" id="adminSPS" value="0"></label><br>
        <button id="adminApply" class="control-btn" style="margin-top:6px;">Apply</button>
      </div>
    </div>
  </div>
  -->

<script>
const SAVE_KEY = 'shrimp_clicker_save_v3';
const LEADERBOARD_KEY = 'shrimp_clicker_lb_v3';
const PLAYER_NAME_KEY = 'shrimp_clicker_player_v1';

let shrimp = 0;
let spc = 1;
let sps = 0;
let bestShrimp = 0;

const upgrades = {
  net:   { base: 20,    count: 0, boost: 1,  type: "spc", visible: true },
  sps1:  { base: 100,   count: 0, boost: 1,  type: "sps", visible: false },
  sps2:  { base: 2000,  count: 0, boost: 10, type: "sps", visible: false },
  sps3:  { base: 50000, count: 0, boost: 100,type: "sps", visible: false }
};

/* Skins config */
const SKINS = [
  { id: 'default', name: 'Default Shrimp', img: 'https://static.vecteezy.com/system/resources/previews/036/161/836/non_2x/tiger-shrimp-on-a-transparent-background-free-png.png', cost: 0 },
  { id: 'tempura', name: 'King Shrimp', img: 'https://www.auraaquarium.com/cdn/shop/products/131_300x300.png?v=1678421939', cost: 250 },
  { id: 'pimp', name: 'Pimp Shrimp', img: 'https://preview.redd.it/ptktkt94of651.jpg?width=640&crop=smart&auto=webp&s=ece45242378a8f10824026038c66fa6891eb2eaf', cost: 500 },
  { id: 'cartoon', name: 'Cartoon Shrimp', img: 'https://dejpknyizje2n.cloudfront.net/media/carstickers/versions/shrimp-emoji-illustration-sticker-u4db4-x450.png', cost: 500 }
];

let unlockedSkins = new Set(['default']);
let equippedSkin = 'default';
let playerName = localStorage.getItem(PLAYER_NAME_KEY) || '';

function formatNumber(num) {
  if (!isFinite(num)) return '0';
  const abs = Math.abs(num);
  if (abs < 1000) return Math.floor(num).toString();
  const abbrev = [
    { v: 1e18, suf: 'E' },
    { v: 1e15, suf: 'P' },
    { v: 1e12, suf: 'T' },
    { v: 1e9,  suf: 'B' },
    { v: 1e6,  suf: 'M' },
    { v: 1e3,  suf: 'K' }
  ];
  for (const a of abbrev) {
    if (abs >= a.v) {
      return (num / a.v).toFixed( (abs / a.v >= 100) ? 0 : (abs / a.v >= 10 ? 1 : 2) ) + a.suf;
    }
  }
  return Math.floor(num).toString();
}

function upgradeCost(upg) {
  return Math.ceil(upg.base * Math.pow(1.15, upg.count));
}

function recalcSPS() {
  let total = 0;
  for (const k in upgrades) {
    if (upgrades[k].type === 'sps') total += upgrades[k].count * upgrades[k].boost;
  }
  sps = +total.toFixed(6);
}

const counterEl = document.getElementById('counter');
const spcEl = document.getElementById('spc');
const spsEl = document.getElementById('sps');
const bestCountEl = document.getElementById('bestCount');
const leadersList = document.getElementById('leaders');
const ownedCountEl = document.getElementById('ownedCount');
const shrimpEl = document.getElementById('shrimp');
const submitLeaderBtn = document.getElementById('submitLeaderBtn');
const playerNameDisplay = document.getElementById('playerNameDisplay');
const nickModal = document.getElementById('nickModal');
const playerNameInput = document.getElementById('playerNameInput');
const playerNameSave = document.getElementById('playerNameSave');

function getSkinImg(id){
  const s = SKINS.find(x=>x.id===id);
  return s ? s.img : SKINS[0].img;
}

function spawnShrimpImage(x,y){
  const img = document.createElement('div');
  img.className='floating-shrimp';
  img.style.left = (x - 24) + 'px';
  img.style.top = (y - 24) + 'px';
  img.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;
  document.body.appendChild(img);
  setTimeout(()=>img.remove(),1300);
}

function showClickEffect(x,y,txt){
  const el = document.createElement('div');
  el.className = 'click-effect';
  el.style.left = (x + 10) + 'px';
  el.style.top = (y - 10) + 'px';
  el.textContent = txt;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),1000);
}

function bump(el){
  if(!el) return;
  el.classList.remove('bump');
  void el.offsetWidth;
  el.classList.add('bump');
}

function updateShrimpImage(){
  shrimpEl.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;
}

function updateUI(){
  counterEl.textContent = formatNumber(Math.floor(shrimp));
  spcEl.textContent = formatNumber(spc);
  spsEl.textContent = formatNumber(sps);
  if (shrimp > bestShrimp) { bestShrimp = shrimp; bestCountEl.textContent = formatNumber(Math.floor(bestShrimp)); }

  for (const key in upgrades) {
    const up = upgrades[key];
    const cost = upgradeCost(up);
    const costEl = document.getElementById('cost-' + key);
    if(costEl) costEl.textContent = formatNumber(cost);
    const btn = document.getElementById('upg-' + key);
    if(btn) {
      btn.disabled = shrimp < cost;
      if (!up.visible && shrimp >= up.base * 0.5) up.visible = true;
      btn.style.display = up.visible ? 'block' : 'none';
    }
  }

  renderLeaderboard();
  ownedCountEl.textContent = String(unlockedSkins.size);
  if(submitLeaderBtn) submitLeaderBtn.disabled = (Math.floor(bestShrimp) <= 0) || !playerName || playerName.trim().length===0;
  updateShrimpImage();
}

function spawnBackgroundShrimp() {
  const amount = Math.min(50, Math.max(1, Math.floor(sps)));

  for (let i = 0; i < amount; i++) {
    const el = document.createElement("div");
    el.className = "falling-shrimp";

    const size = 40 + Math.random() * 60;
    el.style.width = size + "px";
    el.style.height = size + "px";

    el.style.left = Math.random() * window.innerWidth + "px";
    el.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;

    const duration = 3 + Math.random() * 4;
    el.style.animationDuration = duration + "s";

    document.body.appendChild(el);
    setTimeout(() => el.remove(), duration * 1000);
  }
}

setInterval(() => {
  spawnBackgroundShrimp();
}, 1000);

const shopModal = document.getElementById('shopModal');
const shopGrid = document.getElementById('shopGrid');
const shopCloseBtn = document.getElementById('closeShop');

function openShop(){
  renderShop();
  shopModal.classList.add('show');
  shopModal.setAttribute('aria-hidden','false');
}
  if(playerNameDisplay) playerNameDisplay.textContent = playerName || 'Guest';
function closeShop(){
  shopModal.classList.remove('show');
  shopModal.setAttribute('aria-hidden','true');
}

function renderShop(){
  shopGrid.innerHTML = '';
  SKINS.forEach(skin => {
    const item = document.createElement('div');
    item.className = 'shop-item';

    const img = document.createElement('img');
    img.src = skin.img;
    img.alt = skin.name;

    const title = document.createElement('div');
    title.textContent = skin.name;

    const cost = document.createElement('div');
    cost.className = 'meta';
    cost.textContent = skin.cost > 0 ? `${formatNumber(skin.cost)} shrimps` : 'Free';

    item.appendChild(img);
    item.appendChild(title);
    item.appendChild(cost);

    const btnWrap = document.createElement('div');
    btnWrap.style.marginTop = '8px';
    item.appendChild(btnWrap);

    const equipBtn = document.createElement('button');
    equipBtn.className = 'control-btn';
    equipBtn.textContent = 'Equip';
    equipBtn.style.display = 'none';
    equipBtn.addEventListener('click', () => {
      if (!unlockedSkins.has(skin.id)) return;
      equippedSkin = skin.id;
      saveGame(true);
      renderShop();
      updateUI();
    });

    const buyBtn = document.createElement('button');
    buyBtn.className = 'control-btn';
    buyBtn.textContent = `Buy (${formatNumber(skin.cost)})`;
    buyBtn.style.display = 'none';

    buyBtn.addEventListener('click', () => {
      if (shrimp < skin.cost) { alert('Not enough shrimps to buy this skin.'); return; }
      if (!confirm(`Buy "${skin.name}" for ${formatNumber(skin.cost)} shrimps?`)) return;
      shrimp = Math.floor(shrimp - skin.cost);
      unlockedSkins.add(skin.id);
      equippedSkin = skin.id;
      saveGame(true);
      renderShop();
      updateUI();
      alert(`Purchased and equipped "${skin.name}"!`);
    });

    if (unlockedSkins.has(skin.id)) {
      const ownedBadge = document.createElement('div');
      ownedBadge.className = 'owned-badge';
      ownedBadge.textContent = (equippedSkin === skin.id) ? 'Equipped' : 'Owned';
      btnWrap.appendChild(ownedBadge);

      if (equippedSkin !== skin.id) {
        equipBtn.style.display = 'inline-block';
        btnWrap.appendChild(equipBtn);
      }
    } else {
      buyBtn.disabled = shrimp < skin.cost;
      buyBtn.style.display = 'inline-block';
      btnWrap.appendChild(buyBtn);
    }

    shopGrid.appendChild(item);
  });
}

function buyUpgrade(id, animate=true) {
  const up = upgrades[id];
  if (!up) return;
  const cost = upgradeCost(up);
  if (shrimp < cost) return;
  shrimp = Math.floor(shrimp - cost);
  up.count++;
  if (up.type === 'spc') spc += up.boost;
  recalcSPS();
  const btn = document.getElementById('upg-' + id);
  if(btn && animate) { btn.classList.add('flash-buy'); setTimeout(()=>btn.classList.remove('flash-buy'),380); }
  bump(counterEl); bump(spcEl); updateUI();
}

document.getElementById('shrimp').addEventListener('click', (e) => {
  shrimp = Math.floor(shrimp + spc);
  spawnShrimpImage(e.clientX, e.clientY);
  showClickEffect(e.pageX, e.pageY, `+${formatNumber(spc)}`);
  bump(counterEl); updateUI();
});

document.getElementById('upg-net').addEventListener('click', ()=> buyUpgrade('net'));
document.getElementById('upg-sps1').addEventListener('click', ()=> buyUpgrade('sps1'));
document.getElementById('upg-sps2').addEventListener('click', ()=> buyUpgrade('sps2'));
document.getElementById('upg-sps3').addEventListener('click', ()=> buyUpgrade('sps3'));

document.getElementById('shopBtn').addEventListener('click', openShop);
shopCloseBtn.addEventListener('click', closeShop);

/* Passive Income */
setInterval(() => {
  if (sps > 0) {
    shrimp += sps / 10;
    updateUI();
  }
}, 100);

function attemptAutoUpgrade(){
  try{
    const cheapCandidates = [];
    for(const key in upgrades){
      const up = upgrades[key];
      const cost = upgradeCost(up);
      if(shrimp >= cost) cheapCandidates.push({key, cost, value: up.boost / Math.max(1,cost), boost: up.boost, type: up.type});
    }
    if(cheapCandidates.length===0) return;
    cheapCandidates.sort((a,b)=> b.value - a.value || a.cost - b.cost);
    buyUpgrade(cheapCandidates[0].key, false);
  }catch(e){ console.error('Auto-upgrade error', e); }
}

setInterval(()=>{
  attemptAutoUpgrade();
}, 60_000);

function saveGame(manual=false){
  const save = {
    shrimp: Math.floor(shrimp),
    spc, sps, bestShrimp,
    upgrades:{}, timestamp:Date.now(),
    unlockedSkins: Array.from(unlockedSkins),
    equippedSkin,
    playerName
  };
  for(const k in upgrades) save.upgrades[k] = {count: upgrades[k].count, visible: upgrades[k].visible};
  localStorage.setItem(SAVE_KEY, JSON.stringify(save));
  try { saveLeaderboard(loadLeaderboard()); } catch(e) {}
  if(manual){ document.getElementById('saveBtn').textContent='Saved'; setTimeout(()=>document.getElementById('saveBtn').textContent='Save',900); }
}
function loadGame(){
  const raw = localStorage.getItem(SAVE_KEY); if(!raw) return false;
  try{
    const obj = JSON.parse(raw);
    shrimp = obj.shrimp || 0; spc = obj.spc || 1; sps = obj.sps || 0; bestShrimp = obj.bestShrimp || bestShrimp;
    if(obj.upgrades){ for(const k in upgrades){ if(obj.upgrades[k]){ upgrades[k].count=obj.upgrades[k].count||0; upgrades[k].visible=obj.upgrades[k].visible??upgrades[k].visible; }}}
    if (obj.unlockedSkins && Array.isArray(obj.unlockedSkins)) {
      unlockedSkins = new Set(obj.unlockedSkins);
    } else {
      unlockedSkins = new Set(['default']);
    }
    if (obj.equippedSkin) equippedSkin = obj.equippedSkin;
    if (obj.playerName) { playerName = obj.playerName; localStorage.setItem(PLAYER_NAME_KEY, playerName); }
    recalcSPS(); updateUI(); return true;
  }catch(e){ console.error('Load failed',e); return false;}
}
document.getElementById('saveBtn').addEventListener('click', ()=> saveGame(true));
document.getElementById('loadBtn').addEventListener('click', ()=> { const ok = loadGame(); if(!ok) alert('No save found.'); });
setInterval(()=>saveGame(false),5000);
document.getElementById('submitLeaderBtn').addEventListener('click', submitScoreToLeaderboard);
if(playerNameSave){
  playerNameSave.addEventListener('click', ()=>{
    const v = (playerNameInput && playerNameInput.value) ? playerNameInput.value.trim() : '';
    playerName = v || 'Player';
    localStorage.setItem(PLAYER_NAME_KEY, playerName);
    if (nickModal) { nickModal.classList.remove('show'); nickModal.setAttribute('aria-hidden','true'); }
    updateUI();
  });
}

/* Reset */
const resetBtn = document.getElementById('resetBtn');
if(resetBtn) resetBtn.addEventListener('click', ()=> {
  if(!confirm('Reset all progress (including skins & leaderboard)?')) return;
  shrimp=0; spc=1; sps=0; bestShrimp=0;
  for(const k in upgrades){ upgrades[k].count=0; upgrades[k].visible=(k==='net');}
  unlockedSkins = new Set(['default']);
  equippedSkin = 'default';
  localStorage.removeItem(SAVE_KEY);
  localStorage.removeItem(LEADERBOARD_KEY);
  recalcSPS(); updateUI();
  closeShop();
  alert('All progress reset.');
});

/* Leaderboard */
function loadLeaderboard(){ try{ const raw = localStorage.getItem(LEADERBOARD_KEY); if(!raw) return []; return JSON.parse(raw);}catch(e){return[];} }
function saveLeaderboard(list){ localStorage.setItem(LEADERBOARD_KEY,JSON.stringify(list));}
function addToLeaderboard(entry){
  // Validate leaderboard entry
  if(!entry || typeof entry.shrimps !== 'number' || !Number.isFinite(entry.shrimps) || entry.shrimps <= 0) return;
  const list=loadLeaderboard();
  list.push(entry);
  list.sort((a,b)=> (b.shrimps - a.shrimps));
  saveLeaderboard(list.slice(0,10));
  renderLeaderboard();
}
function renderLeaderboard(){
  const list=loadLeaderboard(); leadersList.innerHTML='';
  if(list.length===0){ leadersList.innerHTML='<li style="color:#9aa6b2">No entries yet</li>';}
  else{ list.forEach(e=>{ const li=document.createElement('li'); li.style.marginBottom='4px'; li.style.listStyle='decimal'; li.textContent=`${e.name ? e.name+' ‚Äî ' : ''}${formatNumber(e.shrimps)} shrimps (${new Date(e.date).toLocaleDateString()})`; leadersList.appendChild(li);});}
}

function submitScoreToLeaderboard(){
  if (!Number.isFinite(bestShrimp) || Math.floor(bestShrimp) <= 0) { alert('You must have a score greater than 0 to submit.'); return; }
  const name = (playerName && playerName.trim()) ? playerName.trim() : (prompt('Enter name for Top Players leaderboard (leave blank for "Player")') || 'Player');
  addToLeaderboard({ name: name, shrimps: Math.floor(bestShrimp), date: Date.now() });
  updateUI();
}

/* Init */
(function init(){
  for(const k in upgrades){ upgrades[k].visible=(k==='net')||upgrades[k].visible;}
  const loaded=loadGame();
  if(!loaded) recalcSPS();
  if (!unlockedSkins.has('default')) unlockedSkins.add('default');
  updateUI();
  if(!playerName){
    if(nickModal && playerNameInput){
      nickModal.classList.add('show'); nickModal.setAttribute('aria-hidden','false');
      playerNameInput.focus();
    }
  }
})();

/* Keyboard shortcuts */
document.addEventListener('keydown', (e)=>{ 
  if(e.key==='s'&&(e.ctrlKey||e.metaKey)){ e.preventDefault(); saveGame(true); }
  if(e.key==='l'&&(e.ctrlKey||e.metaKey)){ e.preventDefault(); loadGame(); }
  if(e.key==='p'&& (e.ctrlKey||e.metaKey)){ e.preventDefault(); submitScoreToLeaderboard(); }
});

const adminModal = document.getElementById('adminModal');
const adminPasswordInput = document.getElementById('adminPassword');
const adminControls = document.getElementById('adminControls');
const adminShrimpInput = document.getElementById('adminShrimp');
const adminSPCInput = document.getElementById('adminSPC');
const adminSPSInput = document.getElementById('adminSPS');

if(adminModal){
  const adminCancelBtn = document.getElementById('adminCancel');
  const adminEnterBtn = document.getElementById('adminEnter');
  const adminApplyBtn = document.getElementById('adminApply');

  if(adminCancelBtn) adminCancelBtn.addEventListener('click', () => {
    if(adminModal) adminModal.classList.remove('show');
    if(adminControls) adminControls.style.display='none';
    if(adminPasswordInput) adminPasswordInput.style.display='block';
    const enterBtn = document.getElementById('adminEnter'); if(enterBtn) enterBtn.style.display='inline-block';
    if(adminPasswordInput) adminPasswordInput.value='';
  });

  if(adminEnterBtn) adminEnterBtn.addEventListener('click', () => {
    if(adminPasswordInput && adminPasswordInput.value==='213799'){
      if(adminControls) adminControls.style.display='block';
      if(adminPasswordInput) adminPasswordInput.style.display='none';
      if(adminEnterBtn) adminEnterBtn.style.display='none';
    } else {
      alert('Wrong password!'); if(adminPasswordInput) adminPasswordInput.value='';
    }
  });

  if(adminApplyBtn) adminApplyBtn.addEventListener('click', ()=>{
    if(adminShrimpInput) shrimp=parseFloat(adminShrimpInput.value)||shrimp;
    if(adminSPCInput) spc=parseFloat(adminSPCInput.value)||spc;
    if(adminSPSInput) sps=parseFloat(adminSPSInput.value)||sps;
    recalcSPS(); updateUI();
    alert('Admin values applied!');
    if(adminModal) adminModal.classList.remove('show');
    if(adminControls) adminControls.style.display='none';
    if(adminPasswordInput) adminPasswordInput.style.display='block';
    if(adminEnterBtn) adminEnterBtn.style.display='inline-block';
    if(adminPasswordInput) adminPasswordInput.value='';
  });
}

document.addEventListener('keydown', e=>{
  if(e.key==='`' && adminModal){ 
    adminModal.classList.add('show');
    if(adminPasswordInput) adminPasswordInput.style.display='block';
    const enterBtn = document.getElementById('adminEnter'); if(enterBtn) enterBtn.style.display='inline-block';
    if(adminControls) adminControls.style.display='none';
    if(adminPasswordInput) adminPasswordInput.value='';
  }
});

window.addEventListener('load', ()=>{
  if(adminShrimpInput) adminShrimpInput.value=0;
  if(adminSPCInput) adminSPCInput.value=1;
  if(adminSPSInput) adminSPSInput.value=0;
});
</script>
</body>
</html>
