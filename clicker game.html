<!DOCTYPE html>
<html lang="pl">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Shrimp Clicker ğŸ¦</title>
Â  <style>
Â  Â  :root{
Â  Â  Â  --bg1:#283048; --bg2:#859398; --card:#32323C99;
Â  Â  Â  --btn:#4e5d6c; --btn-hover:#607184; --btn-disabled:#333a41;
Â  Â  Â  --accent:#7dd3fc;Â 
Â  Â  }
Â  Â  html,body {height:100%; margin:0; position:relative; z-index:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:#eee;}

Â  Â  body {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: 1fr minmax(300px, 980px) 1fr;Â 
Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  padding: 24px 0;Â 
Â  Â  }

Â  Â  .leaderboard-container {
Â  Â  Â  Â  grid-column: 1 / 2;
Â  Â  Â  Â  padding-left: 24px;Â 
Â  Â  Â  Â  align-self: start;Â 
Â  Â  }

Â  Â  .game-container{
Â  Â  Â  Â  grid-column: 2 / 3;
Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  text-align:center;
Â  Â  Â  Â  margin: 0;Â 
Â  Â  }

Â  Â  @media (max-width: 980px) {
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr minmax(300px, 100%) 1fr;Â 
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  @media (max-width: 600px) {
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  grid-template-columns: 10px 1fr 10px;Â 
Â  Â  Â  Â  Â  Â  padding: 10px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .leaderboard-container {
Â  Â  Â  Â  Â  Â  grid-column: 2 / 3;Â 
Â  Â  Â  Â  Â  Â  order: 2;Â 
Â  Â  Â  Â  Â  Â  padding-left: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .game-container {
Â  Â  Â  Â  Â  Â  grid-column: 2 / 3;Â 
Â  Â  Â  Â  Â  Â  order: 1;Â 
Â  Â  Â  Â  Â  Â  padding: 10px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .upgrades {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  h1{margin:6px 0;text-shadow:0 2px 4px rgba(0,0,0,.7);}Â  Â Â 
Â  Â  .shrimp{width:200px;height:200px;background:url('https://static.vecteezy.com/system/resources/previews/036/161/836/non_2x/tiger-shrimp-on-a-transparent-background-free-png.png') no-repeat center/contain;margin:18px auto;cursor:pointer;transition:transform .08s ease;}
Â  Â  .shrimp:active{transform:scale(.94);}Â  Â Â 
Â  Â  .stats{margin:10px 0;font-size:1.05rem;}
Â  Â  .count {font-size:2rem;font-weight:700;display:inline-block;min-width:200px;transition:transform .2s;}
Â  Â  .small{font-size:.9rem;color:#cfd8dc;}
Â  Â  .upgrades{margin-top:20px;background:var(--card);display:inline-block;padding:18px 26px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.6);text-align:left;}
Â  Â  .upgrade-btn{display:block;width:100%;text-align:left;padding:12px 16px;margin:8px 0;background-color:var(--btn);color:#f0f0f0;border:1px solid #62717a;border-radius:8px;cursor:pointer;transition:background .15s,transform .08s;}
Â  Â  .upgrade-btn:hover:not(:disabled){background-color:var(--btn-hover);transform:translateX(4px);}
Â  Â  .upgrade-btn:disabled{background-color:var(--btn-disabled);color:#777;cursor:not-allowed;}
Â  Â  .upgrade-cost{float:right;font-weight:700;}
Â  Â  .controls{margin-top:18px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
Â  Â  .control-btn{background:#1f2937;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
Â  Â  .control-btn:disabled{opacity:.5;cursor:not-allowed;}
Â  Â  .floating-shrimp{position:absolute;width:48px;height:48px;background-size:contain;animation:floatUp 1.2s ease-out forwards;pointer-events:none;z-index:120;}
Â  Â  @keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-100px) scale(.9)}}
Â  Â  .click-effect{position:absolute;font-size:1.6rem;font-weight:700;color:#fff;text-shadow:0 0 6px #000;pointer-events:none;animation:floatText 1s ease-out forwards;z-index:130;}
Â  Â  @keyframes floatText{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-80px)}}
Â  Â  .flash-buy{animation:flash .35s linear}
Â  Â  @keyframes flash{0%{box-shadow:0 0 0 0 rgba(125,211,252,.55)}70%{box-shadow:0 0 0 16px rgba(125,211,252,0)}100%{box-shadow:none}}
Â  Â  .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
Â  Â  .meta{font-size:.9rem;color:#cfd8dc}
Â  Â  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000;opacity:0;pointer-events:none;transition:opacity .18s;}
Â  Â  .modal.show{opacity:1;pointer-events:auto}
Â  Â  .modal-card{background:#0f1724;padding:18px;border-radius:12px;color:#fff;min-width:280px;max-width:90%;box-shadow:0 8px 40px rgba(0,0,0,.6)}
Â  Â  .shop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px}
Â  Â  .shop-item{background:#071025;border-radius:10px;padding:10px;text-align:center;border:1px solid rgba(255,255,255,0.04)}
Â  Â  .shop-item img{width:100%;height:120px;object-fit:contain;border-radius:6px;background:#08202a;padding:6px}
Â  Â  .shop-item button{margin-top:8px;width:100%}
Â  Â  .owned-badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#0b7; color:#012; font-weight:700;margin-top:8px}
Â  Â  @media (max-width:640px){
Â  Â  Â  .shrimp{width:150px;height:150px}
Â  Â  Â  .count{min-width:140px;font-size:1.4rem}
Â  Â  }
Â  Â Â 
Â  Â  .leaderboard {
Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  background: rgba(17, 24, 39, 0.9);Â 
Â  Â  Â  Â  padding: 16px;
Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  color: #e6eef3;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);Â 
Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.05);
Â  Â  }
Â  Â  .leaderboard h4 {
Â  Â  Â  Â  margin: 0 0 12px 0;
Â  Â  Â  Â  color: var(--accent);Â 
Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
Â  Â  }
Â  Â  .leaderboard ol {
Â  Â  Â  Â  list-style: none;Â 
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  counter-reset: rank;Â 
Â  Â  }
Â  Â  .leaderboard ol li {
Â  Â  Â  Â  counter-increment: rank;Â 
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  padding: 8px 12px;
Â  Â  Â  Â  margin-bottom: 6px;
Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  font-weight: 500;
Â  Â  }
Â  Â  .leaderboard ol li:hover {
Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.1);
Â  Â  }
Â  Â  .leaderboard ol li::before {
Â  Â  Â  Â  content: counter(rank);Â 
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  min-width: 20px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  margin-right: 12px;
Â  Â  Â  Â  padding: 4px 8px;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  background: #4b5563;Â 
Â  Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  .leaderboard ol li:nth-child(1)::before {
Â  Â  Â  Â  background: #ffd700;Â 
Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
Â  Â  }
Â  Â  .leaderboard ol li:nth-child(2)::before {
Â  Â  Â  Â  background: #c0c0c0;Â 
Â  Â  Â  Â  color: #333;
Â  Â  }
Â  Â  .leaderboard ol li:nth-child(3)::before {
Â  Â  Â  Â  background: #cd7f32;Â 
Â  Â  Â  Â  color: #333;
Â  Â  }

Â  Â  .leaderboard .player-name {
Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  text-overflow: ellipsis;
Â  Â  }
Â  Â  .leaderboard .score {
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  color: var(--accent);
Â  Â  Â  Â  margin-left: 10px;
Â  Â  Â  Â  flex-shrink: 0;Â 
Â  Â  }
Â  Â  .leaderboard .date-meta {
Â  Â  Â  Â  font-size: 0.75rem;
Â  Â  Â  Â  color: #9aa6b2;
Â  Â  Â  Â  margin-left: 10px;
Â  Â  Â  Â  flex-shrink: 0;
Â  Â  }
Â  Â  .bump{animation:bump .18s ease}
Â  Â  @keyframes bump{0%{transform:scale(1)}50%{transform:scale(1.09)}100%{transform:scale(1)}}

Â  Â  .falling-shrimp {
Â  Â  Â  position: fixed;
Â  Â  Â  top: -80px;
Â  Â  Â  width: 60px;
Â  Â  Â  height: 60px;
Â  Â  Â  background-size: contain;
Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  pointer-events: none;
Â  Â  Â  opacity: 0.55;
Â  Â  Â  z-index: -1;
Â  Â  Â  animation: fallShrimp linear forwards;
Â  Â  }

Â  Â  @keyframes fallShrimp {
Â  Â  Â  from { transform: translateY(-120px) rotate(0deg); }
Â  Â  Â  toÂ  Â { transform: translateY(110vh) rotate(360deg); }
Â  Â  }

Â  </style>
</head>
<body>
Â Â 
Â  Â  <div class="leaderboard-container">
Â  Â  Â  Â  <div class="leaderboard" id="leaderboard">
Â  Â  Â  Â  Â  Â  <h4>Top Players</h4>
Â  Â  Â  Â  Â  Â  <ol id="leaders"></ol>
Â  Â  Â  Â  Â  Â  <div style="margin-top:8px;font-size:.85rem;color:#bfcfe0">Best Shrimp Count: <span id="bestCount">0</span></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="game-container">
Â  Â  Â  <h1>ğŸ¦ Shrimp Clicker ğŸ¦</h1>
Â  Â  Â  <div style="font-size:.95rem;color:#bfcfe0;margin-top:6px">Player: <span id="playerNameDisplay">Guest</span></div>

Â  Â  Â  <div id="shrimp" class="shrimp" title="Click me!"></div>

Â  Â  Â  <div class="stats">
Â  Â  Â  Â  <div class="row" style="justify-content:center;align-items:flex-end">
Â  Â  Â  Â  Â  <div style="text-align:center">
Â  Â  Â  Â  Â  Â  <div class="small">Shrimps</div>
Â  Â  Â  Â  Â  Â  <div id="counter" class="count">0</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="text-align:left">
Â  Â  Â  Â  Â  Â  <div class="small">Per Click</div>
Â  Â  Â  Â  Â  Â  <div id="spc" class="count">1</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="text-align:left">
Â  Â  Â  Â  Â  Â  <div class="small">Per Second</div>
Â  Â  Â  Â  Â  Â  <div id="sps" class="count">0</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div style="margin-top:8px;display:flex;justify-content:center;gap:18px;align-items:center;flex-wrap:wrap">
Â  Â  Â  Â  <div style="text-align:center">
Â  Â  Â  Â  Â  <div class="small">Cash</div>
Â  Â  Â  Â  Â  <div id="cashDisplay" class="count">$0.00</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="text-align:center">
Â  Â  Â  Â  Â  <div class="small">Shrimp Price</div>
Â  Â  Â  Â  Â  <div id="priceDisplay" class="count">$0.00</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button id="saveBtn" class="control-btn">Save</button>
Â  Â  Â  Â  <button id="loadBtn" class="control-btn">Load</button>
Â  Â  Â  Â  <button id="submitLeaderBtn" class="control-btn">Submit Score</button>
Â  Â  Â  Â  <button id="shopBtn" class="control-btn">Shop</button>
Â  Â  Â  Â  <button id="sellBtn" class="control-btn">Sell Shrimps</button>
Â  Â  Â  Â  <div style="align-self:center;color:#cbd5e1">Owned skins: <span id="ownedCount">0</span></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="upgrades" id="upgradesBox" aria-live="polite">
Â  Â  Â  Â  <h3>Upgrades</h3>

Â  Â  Â  Â  <button id="upg-net" class="upgrade-btn">
Â  Â  Â  Â  Â  <span class="upgrade-title">Stronger Net (+1 SPC)</span>
Â  Â  Â  Â  Â  <span class="upgrade-cost" id="cost-net">20</span>
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <button id="upg-sps1" class="upgrade-btn">
Â  Â  Â  Â  Â  <span class="upgrade-title">Small Fry Factory (+1 SPS)</span>
Â  Â  Â  Â  Â  <span class="upgrade-cost" id="cost-sps1">100</span>
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <button id="upg-sps2" class="upgrade-btn">
Â  Â  Â  Â  Â  <span class="upgrade-title">Medium Shrimp Farm (+10 SPS)</span>
Â  Â  Â  Â  Â  <span class="upgrade-cost" id="cost-sps2">2000</span>
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <button id="upg-sps3" class="upgrade-btn">
Â  Â  Â  Â  Â  <span class="upgrade-title">Mega Shrimp Reactor (+100 SPS)</span>
Â  Â  Â  Â  Â  <span class="upgrade-cost" id="cost-sps3">50000</span>
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <div style="margin-top:12px" class="meta">
Â  Â  Â  Â  Â  Tip: Upgrades unlock visually when you reach 50% of their base cost.
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  </div>
Â  Â  <div id="nickModal" class="modal" aria-hidden="true">
Â  Â  <div class="modal-card">
Â  Â  Â  <h3>Choose a nickname</h3>
Â  Â  Â  <p>Please enter a player nickname. This will be used for the leaderboard.</p>
Â  Â  Â  <input id="playerNameInput" type="text" placeholder="Type your nickname" style="width:100%;padding:8px;border-radius:6px;border:none;margin-top:8px" />
Â  Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
Â  Â  Â  Â  <button id="playerNameSave" class="control-btn">Save</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â 
Â  <div id="shopModal" class="modal" aria-hidden="true">
Â  Â  <div class="modal-card">
Â  Â  Â  <h3>Shrimp Skins Shop</h3>
Â  Â  Â  <p>Spend shrimps to permanently unlock skins. Click "Equip" to apply a skin.</p>

Â  Â  Â  <div id="shopGrid" class="shop-grid"></div>

Â  Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
Â  Â  Â  Â  <button id="closeShop" class="control-btn">Close</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

<script>
// =======================================================
// **CLIENT-SIDE JAVASCRIPT** - Keys and secure logic REMOVED!
// =======================================================

const SAVE_KEY = 'shrimp_clicker_save_v4';
const PLAYER_NAME_KEY = 'shrimp_clicker_player_v1';

// ğŸ›‘ REMOVED JSONBIN_SECRET_KEY and JSONBIN_BIN_ID!

// ğŸ”‘ New Secure Vercel Endpoints
const SUBMIT_ENDPOINT = '/api/submit-score'; 
const FETCH_ENDPOINT = '/api/get-leaderboard'; 


let shrimp = 0;
let spc = 1;
let sps = 0;
let bestShrimp = 0;

let cash = 0;Â  Â  Â  Â  Â  Â  Â  Â 
let shrimpPrice = 0.25;Â  Â  Â 
let marketMultiplier = 1.0;Â 
let marketTrend = 0;Â  Â  Â  Â Â 

const upgrades = {
Â  net:Â  Â { base: 20,Â  Â  count: 0, boost: 1,Â  type: "spc", visible: true },
Â  sps1:Â  { base: 100,Â  Â count: 0, boost: 1,Â  type: "sps", visible: false },
Â  sps2:Â  { base: 2000,Â  count: 0, boost: 10, type: "sps", visible: false },
Â  sps3:Â  { base: 50000, count: 0, boost: 100,type: "sps", visible: false }
};

const SKINS = [
Â  { id: 'default', name: 'Default Shrimp', img: 'https://static.vecteezy.com/system/resources/previews/036/161/836/non_2x/tiger-shrimp-on-a-transparent-background-free-png.png', cost: 0 },
Â  { id: 'tempura', name: 'King Shrimp', img: 'https://www.auraaquarium.com/cdn/shop/products/131_300x300.png?v=1678421939', cost: 250 },
Â  { id: 'pimp', name: 'Pimp Shrimp', img: 'https://preview.redd.it/ptktkt94of651.jpg?width=640&crop=smart&auto=webp&s=ece45242378a8f10824026038c66fa6891eb2eaf', cost: 100000 },
];

let unlockedSkins = new Set(['default']);
let equippedSkin = 'default';
let playerName = localStorage.getItem(PLAYER_NAME_KEY) || '';

function formatNumber(num) {
Â  if (!isFinite(num)) return '0';
Â  const abs = Math.abs(num);
Â  if (abs < 1000) return Math.floor(num).toString();
Â  const abbrev = [
Â  Â  { v: 1e18, suf: 'E' },
Â  Â  { v: 1e15, suf: 'P' },
Â  Â  { v: 1e12, suf: 'T' },
Â  Â  { v: 1e9,Â  suf: 'B' },
Â  Â  { v: 1e6,Â  suf: 'M' },
Â  Â  { v: 1e3,Â  suf: 'K' }
Â  ];
Â  for (const a of abbrev) {
Â  Â  if (abs >= a.v) {
Â  Â  Â  return (num / a.v).toFixed( (abs / a.v >= 100) ? 0 : (abs / a.v >= 10 ? 1 : 2) ) + a.suf;
Â  Â  }
Â  }
Â  return Math.floor(num).toString();
}

function upgradeCost(upg) {
Â  return Math.ceil(upg.base * Math.pow(1.15, upg.count));
}

function recalcSPS() {
Â  let total = 0;
Â  for (const k in upgrades) {
Â  Â  if (upgrades[k].type === 'sps') total += upgrades[k].count * upgrades[k].boost;
Â  }
Â  sps = +total.toFixed(6);
}

const counterEl = document.getElementById('counter');
const spcEl = document.getElementById('spc');
const spsEl = document.getElementById('sps');
const bestCountEl = document.getElementById('bestCount');
const leadersList = document.getElementById('leaders');
const ownedCountEl = document.getElementById('ownedCount');
const shrimpEl = document.getElementById('shrimp');
const submitLeaderBtn = document.getElementById('submitLeaderBtn');
const playerNameDisplay = document.getElementById('playerNameDisplay');
const nickModal = document.getElementById('nickModal');
const playerNameInput = document.getElementById('playerNameInput');
const playerNameSave = document.getElementById('playerNameSave');
const cashDisplay = document.getElementById('cashDisplay');
const priceDisplay = document.getElementById('priceDisplay');

function getSkinImg(id){
Â  const s = SKINS.find(x=>x.id===id);
Â  return s ? s.img : SKINS[0].img;
}

function spawnShrimpImage(x,y){
Â  const img = document.createElement('div');
Â  img.className='floating-shrimp';
Â  img.style.left = (x - 24) + 'px';
Â  img.style.top = (y - 24) + 'px';
Â  img.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;
Â  document.body.appendChild(img);
Â  setTimeout(()=>img.remove(),1300);
}

function showClickEffect(x,y,txt){
Â  const el = document.createElement('div');
Â  el.className = 'click-effect';
Â  el.style.left = (x + 10) + 'px';
Â  el.style.top = (y - 10) + 'px';
Â  el.textContent = txt;
Â  document.body.appendChild(el);
Â  setTimeout(()=>el.remove(),1000);
}

function bump(el){
Â  if(!el) return;
Â  el.classList.remove('bump');
Â  void el.offsetWidth;
Â  el.classList.add('bump');
}

function updateShrimpImage(){
Â  shrimpEl.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;
}

function updateUI(){
Â  counterEl.textContent = formatNumber(Math.floor(shrimp));
Â  spcEl.textContent = formatNumber(spc);
Â  spsEl.textContent = formatNumber(sps);
Â  cashDisplay.textContent = '$' + Number(cash).toFixed(2);
Â  priceDisplay.textContent = '$' + Number(shrimpPrice).toFixed(2);

Â  if (shrimp > bestShrimp) { bestShrimp = shrimp; }Â 
Â  if (bestCountEl) {
Â  Â  Â  bestCountEl.textContent = formatNumber(Math.floor(bestShrimp));Â 
Â  }

Â  for (const key in upgrades) {
Â  Â  const up = upgrades[key];
Â  Â  const cost = upgradeCost(up);
Â  Â  const costEl = document.getElementById('cost-' + key);
Â  Â  if(costEl) costEl.textContent = '$' + formatNumber(cost);
Â  Â  const btn = document.getElementById('upg-' + key);
Â  Â  if(btn) {
Â  Â  Â  btn.disabled = cash < cost;
Â  Â  Â  if (!up.visible && shrimp >= up.base * 0.5) up.visible = true;
Â  Â  Â  btn.style.display = up.visible ? 'block' : 'none';
Â  Â  }
Â  }

Â  ownedCountEl.textContent = String(unlockedSkins.size);
Â  if(submitLeaderBtn) submitLeaderBtn.disabled = (Math.floor(bestShrimp) <= 0) || !playerName || playerName.trim().length===0;
Â  updateShrimpImage();
}

function tickMarket(){
Â  const r = Math.random();
Â  if (r < 0.3) marketTrend = -1;
Â  else if (r > 0.7) marketTrend = 1;
Â  else marketTrend = 0;

Â  const drift = (Math.random() - 0.5) * 0.06;Â 
Â  const jump = (Math.random() < 0.005) ? ((Math.random() - 0.5) * 0.6) : 0;Â 
Â  marketMultiplier = Math.max(0.3, Math.min(3.0, marketMultiplier + drift * marketTrend + jump));

Â  shrimpPrice = Math.max(0.01, 0.5 * marketMultiplier + (Math.random() - 0.5) * 0.5);

Â  if (priceDisplay) priceDisplay.textContent = '$' + Number(shrimpPrice).toFixed(2);
}

setInterval(tickMarket, 1400);Â 

function spawnBackgroundShrimp() {
Â  const amount = Math.min(50, Math.max(1, Math.floor(sps)));

Â  for (let i = 0; i < amount; i++) {
Â  Â  const el = document.createElement("div");
Â  Â  el.className = "falling-shrimp";

Â  Â  const size = 40 + Math.random() * 60;
Â  Â  el.style.width = size + "px";
Â  Â  el.style.height = size + "px";

Â  Â  el.style.left = Math.random() * window.innerWidth + "px";
Â  Â  el.style.backgroundImage = `url('${getSkinImg(equippedSkin)}')`;

Â  Â  const duration = 3 + Math.random() * 4;
Â  Â  el.style.animationDuration = duration + "s";

Â  Â  document.body.appendChild(el);
Â  Â  setTimeout(() => el.remove(), duration * 1000);
Â  }
}

setInterval(() => {
Â  spawnBackgroundShrimp();
}, 1000);

const shopModal = document.getElementById('shopModal');
const shopGrid = document.getElementById('shopGrid');
const shopCloseBtn = document.getElementById('closeShop');

function openShop(){
Â  renderShop();
Â  shopModal.classList.add('show');
Â  shopModal.setAttribute('aria-hidden','false');
}
Â  if(playerNameDisplay) playerNameDisplay.textContent = playerName || 'Guest';
function closeShop(){
Â  shopModal.classList.remove('show');
Â  shopModal.setAttribute('aria-hidden','true');
}

function renderShop(){
Â  shopGrid.innerHTML = '';
Â  SKINS.forEach(skin => {
Â  Â  const item = document.createElement('div');
Â  Â  item.className = 'shop-item';

Â  Â  const img = document.createElement('img');
Â  Â  img.src = skin.img;
Â  Â  img.alt = skin.name;

Â  Â  const title = document.createElement('div');
Â  Â  title.textContent = skin.name;

Â  Â  const cost = document.createElement('div');
Â  Â  cost.className = 'meta';
Â  Â  cost.textContent = skin.cost > 0 ? `${formatNumber(skin.cost)} shrimps` : 'Free';

Â  Â  item.appendChild(img);
Â  Â  item.appendChild(title);
Â  Â  item.appendChild(cost);

Â  Â  const btnWrap = document.createElement('div');
Â  Â  btnWrap.style.marginTop = '8px';
Â  Â  item.appendChild(btnWrap);

Â  Â  const equipBtn = document.createElement('button');
Â  Â  equipBtn.className = 'control-btn';
Â  Â  equipBtn.textContent = 'Equip';
Â  Â  equipBtn.style.display = 'none';
Â  Â  equipBtn.addEventListener('click', () => {
Â  Â  Â  if (!unlockedSkins.has(skin.id)) return;
Â  Â  Â  equippedSkin = skin.id;
Â  Â  Â  saveGame(true);
Â  Â  Â  renderShop();
Â  Â  Â  updateUI();
Â  Â  });

Â  Â  const buyBtn = document.createElement('button');
Â  Â  buyBtn.className = 'control-btn';
Â  Â  buyBtn.textContent = `Buy (${formatNumber(skin.cost)})`;
Â  Â  buyBtn.style.display = 'none';

Â  Â  buyBtn.addEventListener('click', () => {
Â  Â  Â  if (shrimp < skin.cost) { alert('Not enough shrimps to buy this skin.'); return; }
Â  Â  Â  if (!confirm(`Buy "${skin.name}" for ${formatNumber(skin.cost)} shrimps?`)) return;
Â  Â  Â  shrimp = Math.floor(shrimp - skin.cost);
Â  Â  Â  unlockedSkins.add(skin.id);
Â  Â  Â  equippedSkin = skin.id;
Â  Â  Â  saveGame(true);
Â  Â  Â  renderShop();
Â  Â  Â  updateUI();
Â  Â  Â  alert(`Purchased and equipped "${skin.name}"!`);
Â  Â  });

Â  Â  if (unlockedSkins.has(skin.id)) {
Â  Â  Â  const ownedBadge = document.createElement('div');
Â  Â  Â  ownedBadge.className = 'owned-badge';
Â  Â  Â  ownedBadge.textContent = (equippedSkin === skin.id) ? 'Equipped' : 'Owned';
Â  Â  Â  btnWrap.appendChild(ownedBadge);

Â  Â  Â  if (equippedSkin !== skin.id) {
Â  Â  Â  Â  equipBtn.style.display = 'inline-block';
Â  Â  Â  Â  btnWrap.appendChild(equipBtn);
Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  buyBtn.disabled = shrimp < skin.cost;
Â  Â  Â  buyBtn.style.display = 'inline-block';
Â  Â  Â  btnWrap.appendChild(buyBtn);
Â  Â  }

Â  Â  shopGrid.appendChild(item);
Â  });
}

function buyUpgrade(id, animate=true) {
Â  const up = upgrades[id];
Â  if (!up) return;
Â  const cost = upgradeCost(up);
Â  if (cash < cost) return;
Â  cash = Math.max(0, +(cash - cost).toFixed(2));
Â  up.count++;
Â  if (up.type === 'spc') spc += up.boost;
Â  recalcSPS();
Â  const btn = document.getElementById('upg-' + id);
Â  if(btn && animate) { btn.classList.add('flash-buy'); setTimeout(()=>btn.classList.remove('flash-buy'),380); }
Â  bump(counterEl); bump(spcEl); updateUI();
}

function sellAllShrimps(){
Â  const amount = Math.floor(shrimp);
Â  if (amount <= 0) { alert('You have no shrimps to sell.'); return; }
Â  const earned = +(amount * shrimpPrice).toFixed(2);
Â  shrimp = Math.floor(shrimp - amount);
Â  cash = +(cash + earned).toFixed(2);
Â  updateUI();
Â  alert(`Sold ${amount} shrimps for $${earned.toFixed(2)}.`);
}

function sellShrimpsN(n){
Â  const amount = Math.floor(n);
Â  if (amount <= 0 || amount > shrimp) return 0;
Â  const earned = +(amount * shrimpPrice).toFixed(2);
Â  shrimp = Math.floor(shrimp - amount);
Â  cash = +(cash + earned).toFixed(2);
Â  updateUI();
Â  return earned;
}

document.getElementById('shrimp').addEventListener('click', (e) => {
Â  shrimp = Math.floor(shrimp + spc);
Â  spawnShrimpImage(e.clientX, e.clientY);
Â  showClickEffect(e.pageX, e.pageY, `+${formatNumber(spc)}`);
Â  bump(counterEl); updateUI();
});

document.getElementById('upg-net').addEventListener('click', ()=> buyUpgrade('net'));
document.getElementById('upg-sps1').addEventListener('click', ()=> buyUpgrade('sps1'));
document.getElementById('upg-sps2').addEventListener('click', ()=> buyUpgrade('sps2'));
document.getElementById('upg-sps3').addEventListener('click', ()=> buyUpgrade('sps3'));

document.getElementById('shopBtn').addEventListener('click', openShop);
shopCloseBtn.addEventListener('click', closeShop);
document.getElementById('sellBtn').addEventListener('click', sellAllShrimps);

setInterval(() => {
Â  if (sps > 0) {
Â  Â  shrimp += sps / 10;
Â  Â  updateUI();
Â  }
}, 100);

function attemptAutoUpgrade(){
Â  try{
Â  Â  const cheapCandidates = [];
Â  Â  for(const key in upgrades){
Â  Â  Â  const up = upgrades[key];
Â  Â  Â  const cost = upgradeCost(up);
Â  Â  Â  if(cash >= cost) cheapCandidates.push({key, cost, value: up.boost / Math.max(1,cost), boost: up.boost, type: up.type});
Â  Â  }
Â  Â  if(cheapCandidates.length===0) return;
Â  Â  cheapCandidates.sort((a,b)=> b.value - a.value || a.cost - b.cost);
Â  Â  buyUpgrade(cheapCandidates[0].key, false);
Â  }catch(e){ console.error('Auto-upgrade error', e); }
}

setInterval(()=>{
Â  attemptAutoUpgrade();
}, 60_000);

function saveGame(manual=false){
Â  const save = {
Â  Â  shrimp: Math.floor(shrimp),
Â  Â  spc, sps, bestShrimp,
Â  Â  cash: +(cash.toFixed(2)),
Â  Â  shrimpPrice: +(shrimpPrice.toFixed(4)),
Â  Â  marketMultiplier: +(marketMultiplier.toFixed(4)),
Â  Â  upgrades:{}, timestamp:Date.now(),
Â  Â  unlockedSkins: Array.from(unlockedSkins),
Â  Â  equippedSkin,
Â  Â  playerName
Â  };
Â  for(const k in upgrades) save.upgrades[k] = {count: upgrades[k].count, visible: upgrades[k].visible};
Â  localStorage.setItem(SAVE_KEY, JSON.stringify(save));
Â  if(manual){ document.getElementById('saveBtn').textContent='Saved'; setTimeout(()=>document.getElementById('saveBtn').textContent='Save',900); }
}
function loadGame(){
Â  const raw = localStorage.getItem(SAVE_KEY); if(!raw) return false;
Â  try{
Â  Â  const obj = JSON.parse(raw);
Â  Â  shrimp = obj.shrimp || 0; spc = obj.spc || 1; sps = obj.sps || 0; bestShrimp = obj.bestShrimp || bestShrimp;
Â  Â  cash = obj.cash || cash || 0;
Â  Â  shrimpPrice = obj.shrimpPrice || shrimpPrice || 0.25;
Â  Â  marketMultiplier = obj.marketMultiplier || marketMultiplier || 1.0;
Â  Â  if(obj.upgrades){ for(const k in upgrades){ if(obj.upgrades[k]){ upgrades[k].count=obj.upgrades[k].count||0; upgrades[k].visible=obj.upgrades[k].visible??upgrades[k].visible; }} }
Â  Â  if (obj.unlockedSkins && Array.isArray(obj.unlockedSkins)) {
Â  Â  Â  unlockedSkins = new Set(obj.unlockedSkins);
Â  Â  } else {
Â  Â  Â  unlockedSkins = new Set(['default']);
Â  Â  }
Â  Â  if (obj.equippedSkin) equippedSkin = obj.equippedSkin;
Â  Â  if (obj.playerName) { playerName = obj.playerName; localStorage.setItem(PLAYER_NAME_KEY, playerName); }
Â  Â  recalcSPS(); updateUI(); return true;
Â  }catch(e){ console.error('Load failed',e); return false;}
}
document.getElementById('saveBtn').addEventListener('click', ()=> saveGame(true));
document.getElementById('loadBtn').addEventListener('click', ()=> { const ok = loadGame(); if(!ok) alert('No save found.'); });
setInterval(()=>saveGame(false),5000);

document.getElementById('submitLeaderBtn').addEventListener('click', submitScoreToLeaderboard);

if(playerNameSave){
Â  playerNameSave.addEventListener('click', ()=>{
Â  Â  const v = (playerNameInput && playerNameInput.value) ? playerNameInput.value.trim() : '';
Â  Â  playerName = v || 'Player';
Â  Â  localStorage.setItem(PLAYER_NAME_KEY, playerName);
Â  Â  if (nickModal) { nickModal.classList.remove('show'); nickModal.setAttribute('aria-hidden','true'); }
Â  Â  updateUI();
Â  });
}

// ğŸ›‘ REMOVED processLeaderboard function (Logic moved to Vercel Serverless Function)

/**
 * **SECURE FETCH** - Fetches the processed leaderboard data from the secure Vercel function.
 * @returns {Promise<Array<Object>>} An array of leader objects, or an empty array on failure.
 */
async function loadLeaderboard() {
Â  try {
Â  Â  // Calls the new Vercel endpoint /api/get-leaderboard
Â  Â  const response = await fetch(FETCH_ENDPOINT); 

Â  Â  if (!response.ok) {
Â  Â  Â  Â  throw new Error(`Failed to fetch leaderboard: ${response.status} ${response.statusText}`);
Â  Â  }
Â  Â Â 
Â  Â  // The Vercel function sends back the final array of leaders
Â  Â  const leaders = await response.json(); 
Â  Â  return Array.isArray(leaders) ? leaders : [];
Â  } catch (e) {
Â  Â  console.error('Error loading global leaderboard (Ensure Vercel Function is running):', e);
Â  Â  leadersList.innerHTML = '<li style="color:#f87171; justify-content:center;">Error connecting to global leaderboard.</li>';
Â  Â  return [];Â 
Â  }
}

async function renderLeaderboard() {
Â  const list = await loadLeaderboard();
Â  leadersList.innerHTML = '';
Â Â 
Â  if (list.length === 0) {
Â  Â  leadersList.innerHTML = '<li style="color:#9aa6b2; justify-content:center;">No entries yet</li>';
Â  } else {
Â  Â  list.slice(0, 10).forEach((e) => {
Â  Â  Â  const li = document.createElement('li');
Â  Â  Â Â 
Â  Â  Â  const score = e.shrimps ? formatNumber(e.shrimps) : 'N/A';
Â  Â  Â  const playerName = e.name ? e.name : 'Unknown';
Â  Â  Â  // Use try/catch for date conversion in case the Vercel function isn't sending a date
Â  Â  Â  let dateStr = 'N/A';
Â  Â  Â  try {
Â  Â  Â  Â  dateStr = e.date ? new Date(e.date).toLocaleDateString() : 'N/A';
Â  Â  Â  } catch (err) { /* ignore */ }
Â  Â  Â Â 
Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  <span class="player-name">${playerName}</span>Â 
Â  Â  Â  Â  Â  <span class="score">${score} shrimps</span>
Â  Â  Â  Â  Â  <span class="date-meta">(${dateStr})</span>
Â  Â  Â  `;
Â  Â  Â  leadersList.appendChild(li);
Â  Â  });
Â  }
}

/**
 * **SECURE SUBMIT** - Sends the score to the secure Vercel function.
 */
async function submitScoreToLeaderboard() {
Â  if (!Number.isFinite(bestShrimp) || Math.floor(bestShrimp) <= 0) {
Â  Â  alert('You must have a score greater than 0 to submit.');
Â  Â  return;
Â  }
Â Â 
Â  let name = playerName;
Â  if (!name || name.trim().length === 0 || name === 'Guest') {
Â  Â  Â  name = prompt('Enter name for Top Players leaderboard (leave blank for "Player")') || 'Player';
Â  Â  Â  playerName = name;
Â  Â  Â  localStorage.setItem(PLAYER_NAME_KEY, playerName);
Â  Â  Â  if(playerNameDisplay) playerNameDisplay.textContent = playerName;
Â  }
Â Â 
Â  if (name.trim().length === 0) return;Â 

Â  const scoreData = {
Â  Â  name: name,
Â  Â  shrimps: Math.floor(bestShrimp),
Â  };
Â Â 
Â  try {
Â  Â  // Calls the new Vercel endpoint /api/submit-score
Â  Â  const response = await fetch(SUBMIT_ENDPOINT, {
Â  Â  Â  method: 'POST',Â 
Â  Â  Â  headers: {Â 
Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  },
Â  Â  Â  body: JSON.stringify(scoreData)Â 
Â  Â  });
Â  Â Â 
Â  Â  if (!response.ok) {
Â  Â  Â  const errorData = await response.json();
Â  Â  Â  throw new Error(errorData.error || `Server returned status: ${response.status} ${response.statusText}`);
Â  Â  }
Â  Â Â 
Â  Â  alert(`Score of ${formatNumber(scoreData.shrimps)} submitted and updated globally!`);
Â  Â  await renderLeaderboard();Â 
Â  } catch (e) {
Â  Â  console.error('Error submitting score to Vercel function:', e);
Â  Â  alert('Failed to submit score. Could not connect to or update the global leaderboard. Check Vercel deployment.');
Â  }
}

setInterval(renderLeaderboard, 30000);Â 

(function init(){
Â  for(const k in upgrades){ upgrades[k].visible=(k==='net')||upgrades[k].visible;}
Â  const loaded=loadGame();
Â  if(!loaded) recalcSPS();
Â  if (!unlockedSkins.has('default')) unlockedSkins.add('default');
Â  updateUI();
Â Â 
Â  renderLeaderboard();Â 

Â  if(!playerName || playerName === 'Guest'){
Â  Â  if(nickModal && playerNameInput){
Â  Â  Â  nickModal.classList.add('show'); nickModal.setAttribute('aria-hidden','false');
Â  Â  Â  playerNameInput.focus();
Â  Â  }
Â  }
})();

document.addEventListener('keydown', (e)=>{Â 
Â  if(e.key==='s'&&(e.ctrlKey||e.metaKey)){ e.preventDefault(); saveGame(true); }
Â  if(e.key==='l'&&(e.ctrlKey||e.metaKey)){ e.preventDefault(); loadGame(); }
Â  if(e.key==='p'&& (e.ctrlKey||e.metaKey)){ e.preventDefault(); submitScoreToLeaderboard(); }
});

</script>
</body>
</html>
